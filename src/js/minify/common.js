"use strict";var screen_w=parseInt(window.screen.width);if(screen_w<768)(creat_meta=document.createElement("meta")).name="viewport",creat_meta.content="width=768,initial-scale=0.333333333,minimum-scale=0.333333333,maximum-scale=0.333333333,user-scalable=no",document.head.appendChild(creat_meta);else if(screen_w<=1199){var creat_meta;(creat_meta=document.createElement("meta")).name="viewport",creat_meta.content="width=768,initial-scale=0.55333333,minimum-scale=0.55333333,maximum-scale=0.55333333,user-scalable=no",document.head.appendChild(creat_meta)}var currency="$",emailReg=/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,checkLogin=-1<document.cookie.indexOf("customer_token"),openBox=function(){$("html").css("margin-right",window.innerWidth-document.documentElement.clientWidth),$("html").addClass("window-scroll-fixed")},closeBox=function(){$("html").removeClass("window-scroll-fixed"),$("html").css("margin-right",0)},login=function(){openBox(),$(".sign-wapper").show(),$(".common-bg").show()},btnHandle=function(e){e&&(e.removeAttr("disabled"),e.next(".loading").hide())},ajaxSuccess=function(e,i,a){e?200==e.code?i&&i():400==e.code?(showMsg(e.message),btnHandle(a)):401==e.code&&(btnHandle(a),login()):(showMsg("System busy"),btnHandle(a))},addWish=function(e){var i=$(e).find("i"),a=i.hasClass("active")?"delete":"add",n=i.attr("data-id");n&&$.ajax({url:"/api/wish/setWish",type:"POST",data:{product_id:n,action:a},success:function(e){ajaxSuccess(e,function(){i.toggleClass("active"),getWish()})}})},getWish=function(){checkLogin&&($(".wish-sign").show(),$(".wish-sign.not").hide()),$.ajax({url:"/api/wish/getWish",type:"POST",success:function(n){ajaxSuccess(n,function(){for(var e=n.data,i="",a=0;a<e.length&&(i+='<li><a title="'+e[a].product_name+'" href="'+e[a].url+'"><img src="'+e[a].image+'"></a></li>',2!=a);a++);i?($(".wishlist-header ul").html(i),3<e.length&&0==$(".wishlist-header ul").next("div").length&&(i='<div class="wish-signin"><div class="sing_in"><span>Fulfill your wishs</span><a href="/account/login">Sign in</a></div><div class="view_all"><a href="/account/wish"><span>View All</span></a></div></div>',$(".wishlist-header ul").append(i),checkLogin&&$(".wish-signin .sing_in").hide()),$("span.wish-num").html(e.length)):(i='<p class="wish-sign not">Did you find something you really, really want? </p><p><a href="http://dev.a.songmics.com/account/login">Sign in</a>to keep track of your favorites—anytime, anywhere.</p>',checkLogin&&(i='<p class="wish-sign">Did you find something you really, really want? </p><p>Keep track of your favorites.</p>'),$(".wishlist-header ul").html(i),$("span.wish-num").html(0))})}})},getShopcartItem=function(){$.ajax({url:"/api/cart/getCart",type:"POST",success:function(s){ajaxSuccess(s,function(){var e=s.data.carts,i=s.data.total;if(e){for(var a="",n=0;n<e.length&&(a+="<li>",a+='<div class="shopcartList">',a+='<div class="shopcartList_left">',a+='<a title="'+e[n].product_name+'" href="'+e[n].url+'"><img src="'+e[n].image+'"></a>',a+="</div>",a+='<div class="shopcartList_Right">',a+='<div class="list_Right_top">',a+='<a href="'+e[n].url+'" title="'+e[n].product_name+'" class="shopcartName">'+e[n].product_name+"</a>",a+="</div>",a+='<div class="list_Right_bottom">',a+='<div class="left">',a+='<span>Qty: <i class="number">'+e[n].count+"</i></span>",a+="</div>",a+='<div class="right">',a+='<span class="price">'+currency+e[n].subtotal+"</span>",a+="</div>",a+="</div>",a+="</div>",a+="</div>",a+="</li>",3!=n);n++);a&&($(".shopcart-header ul").html(a),$(".shopcart-header .shopcart_viewAll span").html("SHOWING "+(3<e.length?4:e.length)+" OF "+e.length),$(".shopcart-header .all_price").html(currency+i.total),$(".shopcart-header span.cart-num").html(e.length),$(".shopcart-header .shopcart_viewAll").show(),$(".shopcart-header .view_all").show(),$(".shopcart-header .checkedOut").show())}})}})},stripScript=function(e){var i=new RegExp("[`~!@#$%^&*()=|{}':;',\\[\\].<>/?~！@#￥%……&*（）——|{}【】‘；：”“'。，、？+]");if(0!=e.length){for(var a="",n=0;n<e.length;n++)a+=e.substr(n,1).replace(i,"");return a}},search=function(){var e=$("#search_key").val();if(""!=(e=stripScript(e))&&(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=jQuery.trim(e)).replace(/\s+/gi,"-")).replace(/\*/gi,"-")).replace(/\+/gi,"-")).replace(/\?/gi,"-")).replace(/ˇ/gi,"")).replace(/!/gi,"")).replace(/@/gi,"")).replace(/%/gi,"")).replace(/</gi,"")).replace(/>/gi,"")).replace(/&/gi,"")).replace(/\|/gi,"")).replace(/#/gi,"")).replace(/\//gi,"")).replace(/\(/gi,"")).replace(/\)/gi,"")).replace(/\[/gi,"")).replace(/\]/gi,"")).replace(/"/gi,"")).replace(/'/gi,"")).replace(/\//gi,"")).replace(/\\/gi,"")),""!=(e=(e=e.replace(/(^-*)|(-*$)/gi,"")).trim())){var i="/search?k="+encodeURI(e);window.location.href=i}};function checkSocalLogin(e,i){setInterval(function(){-1<document.cookie.indexOf("customer_token")&&(window.location.href=e)},i||2e3)}function openWin(e,i){var a=(window.screen.availHeight-30-800)/2,n=(window.screen.availWidth-10-800)/2;window.open(e,i||"","height=800, width=800, top="+a+", left="+n)}function getRequest(){var e=location.search,i=new Object;if(-1!=e.indexOf("?")){var a=e.substr(1);strs=a.split("&");for(var n=0;n<strs.length;n++)i[strs[n].split("=")[0]]=unescape(strs[n].split("=")[1])}return i}function showMsg(e,i){$("body").append('<div class="layer-msg"><span>'+e+"</span></div>"),setTimeout("$('.layer-msg').remove()",i||2e3)}$(document).ready(function(){getShopcartItem(),getWish(),$(".sign-wapper .facebook,.sign-wapper .google").on("click",function(){openWin($(this).attr("data-url")),checkSocalLogin(window.location.href)}),checkLogin?($(".personalDetail .sign_in").hide(),$(".personalDetail .sign_up").hide(),$(".wishlist-header .sing_in").hide()):$(".personalDetail .sign_out").hide(),$(".sign-wapper .close").on("click",function(){$(".sign-wapper").hide(),$(".common-bg").hide(),closeBox()}),$(".sign-wapper .loginSumit").on("click",function(){$(".sign-wapper .loading").show();var e=$("#login_email").val(),i=$("#login_pwd").val();$.ajax({url:"/api/account/login",type:"POST",data:{email:e,password:i},success:function(e){ajaxSuccess(e,function(){window.location.href=window.location.href})}})}),$(".footer .emailInput button").on("click",function(){var e=$("#btn_subscription").val(),i=$(".footerList .err_msg");e?emailReg.test(e)?(i.html(""),$.ajax({url:"/api/subscription",type:"POST",data:{email:e},success:function(e){ajaxSuccess(e,function(){showMsg(e.message)})}})):i.html("Please enter a valid email address"):i.html("This is a required field")}),window.confirm=function(e,i,a){if(e&&i){var n='<div class="layer-confirm">';n+='<i class="close iconfont icon-close"></i>',n+="<span class='tipsTitle'>"+e+"</span>",n+='<div class="operationSubmit">',n+='<span class="layer-yes">Yes</span>',n+='<span class="layer-no">No</span>',n+="</div></div>",$("body").append(n),$(".common-bg").show(),openBox(),$(".layer-confirm .layer-yes").on("click",function(){i(),closeBox()}),$(".layer-confirm .layer-no").on("click",function(){a&&a(),$(".layer-confirm").remove(),$(".common-bg").hide(),closeBox()}),$(".layer-confirm .close").on("click",function(){$(".layer-confirm").remove(),$(".common-bg").hide(),closeBox()})}else showMsg("message or callback error")},$(".btn_search").on("click",function(){search()}),$(".track-order .close").on("click",function(){$(".track-order").hide(),$(".common-bg").hide(),closeBox()})});