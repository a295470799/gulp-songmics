"use strict";function checkQty(i,t){if(i&&0<i.length){var a=parseInt(i.val());"u"==t?a++:"d"==t&&a--,a<=1?i.val(1):10<=a?i.val(10):i.val(a)}}function showLoading(){$(".loading").show(),$(".view-more").hide(),$(".view-more .no-item").hide(),$("#view_more").show()}function hideLoading(){$(".loading").hide(),$(".view-more").show()}function noData(i,t){i?($(".list-products").html(""),$("#view_more").hide(),$(".view-more .no-item").show()):($(".loading").hide(),$(".view-more").hide()),t&&0<t&&$(".view-more").hide()}$(document).ready(function(){$(".list-products").on("mousemove",".product-list dt",function(){var i=$(this).find("img"),t=i.attr("data-next");i.prop("src",t),$(this).find(".quick-review").show()}),$(".list-products").on("mouseout",".product-list dt",function(){var i=$(this).find("img"),t=i.attr("data-original");i.prop("src",t),$(this).find(".quick-review").hide()}),$(".list-products").on("click",".quick-review",function(){getQuickView($(this).attr("data-id")),openBox()}),$(".list-main").on("click",".qv-close",function(){$(".qv-main").remove(),$(".bg-qucik").hide(),closeBox()}),$(".list-main").on("click",".qty-up",function(){checkQty($(this).siblings("input"),"u")}),$(".list-main").on("click",".qty-down",function(){checkQty($(this).siblings("input"),"d")}),$(".list-main").on("blur","#qty_num",function(){checkQty($(this))}),$(".list-filter-price-ok").on("click",function(){var i=$("#price-begin").val(),t=$("#price-end").val();if(t||i)if(i=parseFloat(i),t=parseFloat(t),i<=0||t<=0)showMsg("Cannot be less than 0");else if(t<i)showMsg("incorrect price");else{$("#index_category_id").val();getProducts(!0,i,t)}else showMsg("Please enter price")}),$(".list-filter-price-reset").on("click",function(){clearPrice()}),$("#view_more").on("click",function(){getProducts(!1)}),$("img.lazy").lazyload({effect:"fadeIn"}),$(".list-filter-ot span[data-type]").on("click",function(){$(".list-filter-ot span[data-type]").removeClass("active"),$(this).addClass("active"),clearRight(),getProducts(!0)}),$(".sort-by-cont span[data-type]").on("click",function(){$(".sort-by-title span").attr("data-type",$(this).attr("data-type")),$(".sort-by-title span").html($(this).html()),$(".list-filter-ot span[data-type]").removeClass("active"),getProducts(!0)}),$(".list-main").on("click",".addwish",function(){addWish(this)}),$(".list-main").on("click",".option span[data-sku]",function(){var i=$(this).attr("data-pid");i&&getQuickView(i)}),$(".list-main").on("click",".addtocart",function(){var i=$(this);shopCart.add(i.attr("data-id"),$("#qty_num").val(),function(){i.html("Added"),setTimeout(function(){i.html("Add to Cart")},800)})})});var pageIndex=1;function getProducts(v,i,t){var a=$("#index_category_id").val();if(a){showLoading();v&&(pageIndex=0),pageIndex++;var e=$(".sort-by-title span").attr("data-type")||$(".list-filter-ot span[data-type].active").attr("data-type");$.ajax({url:"/api/product/getProducts",type:"POST",data:{page:pageIndex,category_id:a,min_price:0|i,max_price:0|t,order:e,label:""},success:function(p){ajaxSuccess(p,function(){hideLoading();var i=p.data;if(i){i.nav&&$(".bread-crumbs").html(i.nav);var t=parseInt(i.page_count),a=parseInt(i.params.page_size),e=parseInt(i.total);e<t*a&&noData(v,e);var s="",n=i.products;if(n&&0<n.length){for(var o=0;o<n.length;o++){var r=parseFloat(n[o].discount),d=n[o].url,c=n[o].product_name;s+='<dl class="product-list">',s+="<dt>",s+='<a href="'+d+'" title="'+c+'">',s+='<img src="'+n[o].image+'" data-original="'+n[o].image+'" data-next="'+n[o].image_addition+'" alt="'+c+'">',s+="</a>",n[o].label?s+='<div class="special-icon">'+n[o].label+"</div>":0<r&&(s+='<div class="off-sale">',s+=(r*=100)<10?"<span>&nbsp;&nbsp;"+r+"</span>":"<span>"+r+"</span>",s+="</div>"),s+='<div class="addwish">';var l=1==n[o].wish?"active":"";s+='<i data-id="'+n[o].id+'" class="iconfont '+l+'"></i>',s+="</div>",s+='<div data-id="'+n[o].id+'" class="quick-review">quick view</div>',s+="</dt><dd>",s+="<p>",s+='<a href="'+d+'" title="'+c+'">'+c+"</a>",s+="</p>",0<r?(s+='<div class="p-price">',s+='<div class="current-price">',s+="<span>$</span><span>"+n[o].price+"</span>",s+="</div>",s+='<del class="original-price">',s+="<span>$</span><span>"+n[o].discount_price+"</span>",s+="</del>"):(s+='<div class="p-price">',s+="<span>$</span><span>"+n[o].price+"</span>"),s+="</div>",s+="</dd></dl>"}v?$(".list-products").html(s):$($(".product-list")[$(".product-list").length-1]).after(s)}else noData(v)}})}})}}function getQuickView(i){if(i){$.ajax({url:"/api/product/getProductQuick",type:"POST",data:{product_id:i},success:function(v){ajaxSuccess(v,function(){var i=v.data,t=i.images,a=i.attributes,e="";$(".qv-main")&&$(".qv-main").remove();var s='<div class="qv-main">';s+='<div class="iconfont icon-close qv-close"></div>',s+='<div class="qv-pics">',s+='<div class="swiper-container gallery-top">',s+='<div class="swiper-wrapper">';for(var n=0;n<t.length;n++)s+='<div class="swiper-slide"><img src="'+t[n].image+'" /></div>';s+="</div>",s+="</div>",s+='<div class="swiper-container gallery-thumbs">',s+='<div class="swiper-wrapper">';for(n=0;n<t.length;n++)s+='<div class="swiper-slide"><img src="'+t[n].image+'" /></div>';s+="</div>",s+='<div class="swiper-button-next swiper-button-white"></div>',s+='<div class="swiper-button-prev swiper-button-white"></div>',s+="</div>",s+="</div>",s+='<div class="qv-content">',s+='<div class="qv-title">',s+='<div class="qv-stitle">'+i.short_name+"</div>",s+='<div class="av-ltitle">'+i.name+"</div>",s+="</div>",s+='<div class="qv-price">',s+='<div class="qv-nprice">',s+="<span>$</span><span>"+i.price+"</span>",s+="</div>",0<parseFloat(i.discount)&&(s+='<del class="qv-oprice">',s+="<span>$</span><span>"+i.discount_price+"</span>",s+="</del>"),s+="</div>",s+='<div class="qv-middle points">',s+='<span class="qv-freeship">free shipping</span>',s+="<span>|</span>",s+="<span>"+i.comment_count+" Reviews</span>",s+='<span class="star star'+i.star+'"></span>',s+="<span>"+i.pointProportion+" points</span>",s+="</div>",s+='<div class="qv-options">',a=objOfValueToArr(a);for(n=0;n<a.length;n++){s+='<div class="option">',s+='<div class="item-left" data-id="'+a[n].attribute_id+'">'+a[n].attribute_name+"</div>",a[n].attribute_option=objOfValueToArr(a[n].attribute_option);for(var o=0;o<a[n].attribute_option.length;o++){var r=a[n].attribute_option[o].id,d=a[n].attribute_option[o].attribute_option_value;e=1==a[n].attribute_option[o].selected?"item active":"";var c=1==a[n].attribute_option[o].is_click?"item":"",l="";c&&(l+=' data-pid="'+a[n].attribute_option[o].product_id+'" data-sku="'+a[n].attribute_option[o].sku+'"'),s+="<span"+l+' data-id="'+r+'" data-name="'+d+'" class="'+c+e+'">'+d+"</span>"}s+="</div>"}s+='<div class="option-qty">',s+='<div class="item-qty">QTY</div>',s+='<div class="item-qty-num">',s+='<input type="number" min="1" max="10" id="qty_num" value="1" />',s+='<span class="qty-up"></span>',s+='<span class="qty-down"></span>',s+="</div>",s+="</div>",s+='<div class="option-buy">',s+='<span data-id="'+i.id+'" class="addtocart">Add to Cart</span>',s+='<a href=""><span class="buyamazon">Buy on Amazon</span></a>',s+="</div>",s+='<div class="addwish">',s+="<div>",e=1==i.wish?"active":"",s+='<i data-id="'+i.id+'" class="iconfont icon-likeHover '+e+'"></i>',s+="<span>Add to Wish List</span>",s+="</div>",s+="</div>",s+="</div>",s+='<div class="qv-details"><a href="'+i.url+'">View Full Details</a></div>',s+="</div>",s+="</div>",$(".list-main").append(s);var p=new Swiper(".gallery-thumbs",{spaceBetween:10,slidesPerView:6,freeMode:!0,watchSlidesVisibility:!0,watchSlidesProgress:!0,observer:!0,observeParents:!0});new Swiper(".gallery-top",{spaceBetween:10,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},thumbs:{swiper:p},observer:!0,observeParents:!0});$(".qv-main").show(),$(".bg-qucik").show()})}})}}function objOfValueToArr(i){var t=[],a=0;for(var e in i)t[a]=i[e],a++;return t}function clearAll(){clearLeft(),clearPrice(),clearRight()}function clearLeft(){$(".list-filter-ot span[data-type]").removeClass("active"),$($(".list-filter-ot span[data-type]")[0]).addClass("active")}function clearPrice(){$("#price-begin").val(""),$("#price-end").val("")}function clearRight(){$(".sort-by-title span").html("Most Relevant").attr("data-type","")}