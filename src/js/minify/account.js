"use strict";var updateName=function(){var i=$("#firstname").val(),a=$("#lastname").val();i&&a&&$.ajax({url:"/api/account/updateName",type:"POST",data:{firstname:i,lastname:a},success:function(e){ajaxSuccess(e,function(){showMsg(e.message),$(".name_i").html(i+" "+a),$(".name_info").hide(),$(".name_info").prev(".info").show()})}})},updateEmail=function(){var e=$("#password_email").val(),i=$("#new_email").val(),a=$("#confirm_email").val();e&&i&&a&&$.ajax({url:"/api/account/updateEmail",type:"POST",data:{password_current:e,email_new:i,email_confirm:a},success:function(e){ajaxSuccess(e,function(){showMsg(e.message),$(".email_i").html(i),$(".email_info").hide(),$(".email_info").prev(".info").show()})}})},updatePassword=function(){var e=$("#password_current").val(),i=$("#password_new").val(),a=$("#password_confirm").val();e&&i&&a&&$.ajax({url:"/api/account/updatePassword",type:"POST",data:{password_current:e,password_new:i,password_confirm:a},success:function(e){ajaxSuccess(e,function(){showMsg(e.message),$(".pwd_info").hide(),$(".pwd_info").prev(".info").show()})}})},removeWish=function(e,i){e&&$.ajax({url:"/api/wish/setWish",type:"POST",data:{product_id:e,action:"delete"},success:function(e){ajaxSuccess(e,function(){i&&i()})}})},addressField={email:$(".tableDetail #email"),phone:$(".tableDetail #phone"),phone_standby:$(".tableDetail #altematePhone"),firstname:$(".tableDetail #firstName"),lastname:$(".tableDetail #lastName"),address_1:$(".tableDetail #address1"),address_2:$(".tableDetail #address2"),postcode:$(".tableDetail #zipCode"),country:$(".tableDetail #country"),zone:$(".tableDetail #state"),city:$(".tableDetail #city"),address_id:$("#address_id")},showForm=function(e,i,a,s){openBox(),$(".payment_title span").html(e),$(".shippingEditAddress .saveDefault label").html(i);var t=$(".shippingEditAddress .continue span");if(a){t.addClass("edit");var r=JSON.parse(a);addressField.email.val(r.email),addressField.firstname.val(r.firstname),addressField.lastname.val(r.lastname),addressField.address_1.val(r.address_1),addressField.address_2.val(r.address_2),addressField.country.val(r.country_id),addressField.city.val(r.city),addressField.postcode.val(r.postcode),addressField.phone.val(r.phone),addressField.phone_standby.val(r.phone_standby),addressField.zone.val(r.zone_id),addressField.address_id.val(r.id)}else t.addClass("add");$(".common-bg").show(),$(".shippingEditAddress").show(),s?(t.addClass("billing"),$(".shippingEditAddress .tableLeft .tableList .shipBill").show()):(t.addClass("shipping"),$(".shippingEditAddress .tableLeft .tableList .shipBill").hide())},addressOperate=function(e){$.ajax({url:e,type:"POST",data:getAddressData(),success:function(e){ajaxSuccess(e,function(){window.location.href=window.location.href})}})},deleteOrSetDefault=function(e,i,a){if(e){var s=a?{address_id:e}:{address_id:e,type:i};$.ajax({url:a?"/api/address/delete":"/api/address/setDefault",type:"POST",data:s,success:function(e){ajaxSuccess(e,function(){window.location.href=window.location.href})}})}else showMsg("System busy")},getAddressData=function(){return{email:addressField.email.val(),phone:addressField.phone.val(),phone_standby:addressField.phone_standby.val(),firstname:addressField.firstname.val(),lastname:addressField.lastname.val(),address_1:addressField.address_1.val(),address_2:addressField.address_2.val()||"",postcode:addressField.postcode.val(),country_id:addressField.country.val(),zone_id:addressField.zone.val(),city:addressField.city.val(),address_id:addressField.address_id.val()||"",status:$("#save_default").prop("checked")?1:""}},searchOrder=function(){window.location.href="/account/order?number="+$("#order_search").val()};$(document).ready(function(){$(".infoRight span.edit").on("click",function(){$(this).parents(".info").hide(),$(this).parents(".info").next(".infoEdit").show()}),$(".infoEdit .cancel").on("click",function(){$(this).parents(".infoEdit").prev(".info").show(),$(this).parents(".infoEdit").hide()}),$(".name_update").on("click",function(){$(this).parents(".infoEdit").find("input").blur(),0==$(this).parents(".infoEdit").find("input.err").length&&updateName()}),$(".email_update").on("click",function(){$(this).parents(".infoEdit").find("input").blur(),0==$(this).parents(".infoEdit").find("input.err").length&&updateEmail()}),$(".pwd_update").on("click",function(){$(this).parents(".infoEdit").find("input").blur(),0==$(this).parents(".infoEdit").find("input.err").length&&updatePassword()}),$(".informationDetail input").on("blur",function(){var e=$(this).val(),i=$(this).prop("id"),a=$(this).next(".errorMes"),s=!0;if(e){if("new_email"==i||"confirm_email"==i){/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/.test(e)||(s=!1,a.html("Please enter the correct format")),"confirm_email"==i&&e!=$("#new_email").val()&&(a.html("Please enter the same email again"),s=!1)}if("password_new"==i||"password_confirm"==i){/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/.test(e)||(s=!1,a.html("Please enter a password between 6-25 characters long and contains both letters and numbers. Special characters are not allowed.")),"password_confirm"==i&&e!=$("#password_new").val()&&(a.html("Your passwords do not match. Please confirm your password."),s=!1)}}else a.html("This is a required field"),s=!1;s?($(this).removeClass("err"),a.html("")):$(this).addClass("err")}),$(".informationRight").on("click",".addToCart",function(){var e=$(this).parents(".operation").attr("data-id");confirm("1 item added to your shopping cart.",function(){shopCart.add(e),window.location.href=window.location.href})}),$(".informationRight .wishOperation").on("click",".delete",function(){var i=$(this);confirm("Are you sure to delete this item from your wish list?",function(){var e=i.parents(".operation").attr("data-id");removeWish(e,function(){window.location.href=window.location.href})})}),$(".shippingEditAddress .continue span").on("click",function(){$(".shippingEditAddress input[required],select[required]").blur(),0==$(".shippingEditAddress input[required].err,select[required].err").length&&($(this).hasClass("add")?$(this).hasClass("shipping")?addressOperate("/api/address/createShipping"):addressOperate("/api/address/createBilling"):$(this).hasClass("edit")&&($(this).hasClass("shipping")?addressOperate("/api/address/updateShipping"):addressOperate("/api/address/updateBilling")))}),$(".addNew.shipping,.shippingAddNew").on("click",function(){showForm("add new shipping address","Save as default shipping address")}),$(".edit.shipping").on("click",function(){var e=$(this).siblings(".address_info").val();showForm("edit the shipping address","Save as default shipping address",e,null)}),$(".addNew.billing,.billingAddNew").on("click",function(){showForm("add new billing address","Save as default billing address",null,!0)}),$(".edit.billing").on("click",function(){var e=$(this).siblings(".address_info").val();showForm("edit the billing address","Save as default billing address",e,!0)}),$(".shippingEditAddress .close").on("click",function(){$(".common-bg").hide(),$(".shippingEditAddress").hide(),$(".tableDetail input").val(""),$(".shippingEditAddress .continue span").removeClass(),closeBox()}),$(".personRight").on("click",".moreAddress div",function(){$(this).parents(".moreAddress").siblings(".addressDetail").find("li.other").toggle(),$(this).hide(),$(this).hasClass("more")?$(this).siblings(".less").show():$(this).siblings(".more").show()}),$(".shippingEditAddress input[required],select[required]").on("blur",function(){var e=$(this),i=e.val(),a=e.prop("id"),s=e.siblings(".totalerror");if(i)if(-1<a.indexOf("email")){/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/.test(i)?(e.removeClass("err"),s.html("")):(e.addClass("err"),s.html("Please enter the correct format").show())}else if(-1<a.indexOf("phone")){/^[0-9]{10,12}$/.test(i)?(e.removeClass("err"),s.html("")):(e.addClass("err"),s.html("Please enter the correct format").show())}else e.removeClass("err"),s.html("");else e.addClass("err"),s.html("This is a required field").show()}),$(".addressDetail .delete .del").on("click",function(){var e=$(this).parents("li").attr("data-id");confirm("Are you sure to delete this shipping address?",function(){deleteOrSetDefault(e,null,!0)})}),$(".addressDetail .delete .setDefalt").on("click",function(){var e=$(this).parents("li").attr("data-id");$(this).hasClass("billing")?deleteOrSetDefault(e,"billing"):deleteOrSetDefault(e,"shipping")}),$("#checked_sameship").on("click",function(){if($(this).prop("checked")){var e=$("#shipping_default").val();if(e){var i=JSON.parse(e);i&&(addressField.email.val(i.email),addressField.firstname.val(i.firstname),addressField.lastname.val(i.lastname),addressField.address_1.val(i.address_1),addressField.address_2.val(i.address_2),addressField.country.val(i.country_id),addressField.city.val(i.city),addressField.postcode.val(i.postcode),addressField.phone.val(i.phone),addressField.phone_standby.val(i.phone_standby),addressField.zone.val(i.zone_id))}}}),$(".liOperation .cancel_order").on("click",function(){var i=$(this);confirm("Do you confirm to cancel the order?",function(){var e=i.parents(".liOperation").attr("data-id");e&&$.ajax({url:"/api/order/cancel",type:"POST",data:{id:e},success:function(e){ajaxSuccess(e,function(){window.location.href=window.location.href})}})})}),$(".liOperation .delete_order").on("click",function(){var i=$(this);confirm("Do you confirm to delete the order?",function(){var e=i.parents(".liOperation").attr("data-id");e&&$.ajax({url:"/api/order/delete",type:"POST",data:{id:e},success:function(e){ajaxSuccess(e,function(){window.location.href=window.location.href})}})})}),$(".orderSearch span").on("click",function(){searchOrder()}),$(".reviewListDetail .reviewText .moreLess").on("click",function(){$(this).parent().toggleClass("more"),$(this).toggleClass("act"),$(this).hasClass("act")?$(this).html("less view"):$(this).html("...more view")}),$(".reviewList .picture li img").on("click",function(){$(this).parent("li").addClass("active").siblings().removeClass("active");var e=$(this).prop("src"),i=$($(this).parents(".picture").find(".big_picture img"));e==i.prop("src")?(i.prop("src",""),$(this).parent("li").removeClass("active")):i.prop("src",e)}),$(".reviewListDetail .commentText").each(function(){230<$(this).html().length?$(this).children(".moreLess").show():($(this).children(".moreLess").hide(),$(this).css("height","auto"))}),$(".reviewListDetail .delete").on("click",function(){var e=$(this).attr("data-id");e&&confirm("Are you sure to delete this item from your reviews?",function(){$.ajax({url:"/api/comment/delete",type:"POST",data:{comment_id:e},success:function(e){ajaxSuccess(e,function(){window.location.href=window.location.href})}})})}),$(".reviewProup .upload_pic").on("mouseover",".removePic img",function(){var e=$(this).prop("src");$(".reviewProup .bigPic").html("<img src="+e+">").show()}),$(".reviewProup .upload_pic").on("mouseout",".removePic img",function(){$(".reviewProup .bigPic").html("").hide()}),$(".upload_pic").on("click",".icon-removePic",function(){$(this).parents(".removePic").remove()}),$(".liPrice .review").on("click",function(){$(".reviewProup .product_name").html($(this).attr("data-title")),$(".reviewProup .product_img").prop("src",$(this).attr("data-img")),$("#review_pid").val($(this).attr("data-id")),$(".common-bg").show(),$(".reviewProup").show(),openBox()}),$(".reviewProup .close").on("click",function(){$(".common-bg").hide(),$(".reviewProup").hide(),closeBox()}),$("#pic_upload").on("change",function(e){var i,a=e.target.files;if(a&&0<a.length){if(5242880<(i=a[0]).size)return showMsg("Sorry, The file you are trying to upload exceeds the 5MB attachment limit."),!1;if(window.FileReader){var s=new FileReader;s.readAsDataURL(i),s.onloadend=function(e){$(".review_picture .upload_pic").append("<div class='removePic'><img src = "+e.target.result+"><span class='iconfont icon-removePic'></span></div>"),document.getElementById("pic_upload").value=""}}}}),$(".reviewProup .btn_submit").on("click",function(){for(var i=$(this),e=$("#star_point").val(),a=$("#review_title").val(),s=$("#review_cont").val(),t=$("#review_pid").val(),r=$(".removePic img"),d=[],n=0;n<r.length;n++)d.push(r[n].src);$("#star").next(".err_msg").remove(),$(".review_title").find(".err_msg").remove(),$(".review_text").find(".err_msg").remove(),e||$("#star").after('<div class="err_msg">Please select the Rating</div>'),a||$(".review_title").append('<div class="err_msg">Please enter the title</div>'),a||$(".review_text").append('<div class="err_msg">Please enter your review</div>'),0!=$(".reviewProup .err_msg").length||i.attr("disabled")||(i.next(".loading").show(),i.attr("disabled",!0),$.ajax({url:"/api/comment/create",type:"POST",data:{title:a,content:s,product_id:t,point:e,images:d},success:function(e){ajaxSuccess(e,function(){window.location.href=window.location.href},i)}}))}),$(".trackOrder").on("click",function(){$(".track-order .title").siblings("div").remove();var e=$("#order_id").val();order_id&&$.ajax({url:"/api/track/list",type:"POST",data:{order_number:e},success:function(s){ajaxSuccess(s,function(){for(var e=s.data,i="",a=0;a<e.length;a++)i+='<div class="border"><p>Tracking Number:<span>'+e[a].track_number+"</span></p><p>Carrier:<span>"+e[a].track_code+'</span></p><p>Tracking URL:<a target="_blank" href="'+e[a].track_url+'">View</a></p></div>';$(".track-order .title").after(i),$(".track-order").show(),$(".common-bg").show(),openBox()})}})})});